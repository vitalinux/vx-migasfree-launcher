#!/bin/bash
_FIRST=/var/tmp/migasfree/first-tags.conf
_USER=`python -c "from migasfree_client import utils;print utils.get_graphic_user(utils.get_graphic_pid()[0])"`

# block update-notifier
mv /etc/xdg/autostart/update-notifier.desktop /etc/xdg/autostart/update-notifier.desktop.migasfree-launcher >/dev/null || :

if [ -f $_FIRST ] ; then
  _TAGS="$(cat $_FIRST)"
  if [ -z $_TAGS ] ; then
    xterm -T "COMPLETANDO LA INSTALACION..." -e "sudo /usr/bin/migasfree-tags --set '' && rm -f $_FIRST && echo 'Proceso completado.' && sleep 3"
  else
    xterm -T "COMPLETANDO LA INSTALACION..." -e "sudo /usr/bin/migasfree-tags --set $_TAGS && rm -f $_FIRST && echo 'Proceso completado.' && sleep 3"
  fi
else
  sudo /usr/bin/migasfree --update
fi

# Packages that require license confirmation
apt-get install ubuntu-restricted-extras

# run update-notifier
su -c "/usr/bin/update-notifier" $_USER &
